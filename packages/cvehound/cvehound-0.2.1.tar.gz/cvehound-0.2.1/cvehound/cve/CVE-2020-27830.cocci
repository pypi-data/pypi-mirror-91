/// Files: drivers/accessibility/speakup/spk_ttyio.c drivers/staging/speakup/spk_ttyio.c
/// Fix: f0992098cadb4c9c6a00703b66cafe604e178fea

virtual detect

@err_spk_ttyio_ldisc_open@
identifier tty;
position p;
@@

spk_ttyio_ldisc_open(struct tty_struct *tty)
{
	... when != if (tty != speakup_tty) return -ENODEV;
	return 0;@p
}

@err_spk_ttyio_initialise_ldisc@
identifier tty;
position p;
@@

spk_ttyio_initialise_ldisc(...)
{
	...
	struct tty_struct *tty;
	... when != speakup_tty = tty;
	return ...;@p
}

@script:python depends on detect@
p << err_spk_ttyio_ldisc_open.p;
@@

coccilib.report.print_report(p[0], "ERROR: CVE-2020-27830")

@script:python depends on detect@
p << err_spk_ttyio_initialise_ldisc.p;
@@

coccilib.report.print_report(p[0], "ERROR: CVE-2020-27830")
