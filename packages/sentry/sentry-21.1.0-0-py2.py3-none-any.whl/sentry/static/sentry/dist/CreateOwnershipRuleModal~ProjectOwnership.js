(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[16],{2379:function(e,t,n){"use strict";var a=n(9),r=n.n(a),i=n(10),l=n.n(i),o=n(11),c=n.n(o),s=n(13),u=n.n(s),p=n(5),d=n.n(p),f=n(3),h=n(1),b=n.n(h),g=n(1057),m=n.n(g),O=n(34),v=n(55),j=n(26),y=n(4),w=n(171),x=n(147),C=n(319),k=n(31),S=n(182),R=n(290),T=n(16),U=n(7),P=n(220),A=n(22),I=n.n(A),M=n(30),z=n.n(M),N=n(24),V=n.n(N),B=n(8),D=n.n(B),q=n(19),L=n.n(q),E=n(39),J=n.n(E),K=n(152),W=n.n(K),F=n(60),H=n.n(F),Y=n(433),_=n(456),G=n(6),Q=n.n(G),X=n(119),Z=n(0),$=b.a.forwardRef((function(e,t){return Object(Z.f)(X.a,Q()({forwardedRef:t},e,{multiple:!0}))})),ee=n(177),te=n(32),ne=n(223),ae=n(21),re=n(50),ie=n(176);function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){D()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}function se(e){var t=e.value,n=e.onRemove;return Object(Z.f)("a",{onClick:function(){return n(t)}},Object(Z.f)(_.a,{actor:t.actor,size:28}))}se.displayName="ValueComponent";var ue=function(e){return"".concat(e.email&&e.email.toLowerCase()," ").concat(e.name&&e.name.toLowerCase())},pe={name:"fs1hps-SelectOwners",styles:"width:200px;;label:SelectOwners;"},de=function(e){c()(a,e);var t,n=ce(a);function a(){var e;r()(this,a);for(var t=arguments.length,i=new Array(t),l=0;l<t;l++)i[l]=arguments[l];return(e=n.call.apply(n,[this].concat(i))).state={loading:!1,inputValue:""},e.selectRef=b.a.createRef(),e.renderUserBadge=function(e){return Object(Z.f)(ee.a,{avatarSize:24,user:e,hideEmail:!0,useLink:!1})},e.createMentionableUser=function(t){return{value:Object(ae.b)(t.id),label:e.renderUserBadge(t),searchKey:ue(t),actor:{type:"user",id:t.id,name:t.name}}},e.createUnmentionableUser=function(t){var n=t.user;return oe(oe({},e.createMentionableUser(n)),{},{disabled:!0,label:Object(Z.f)(be,null,Object(Z.f)(te.a,{position:"left",title:Object(y.b)("%s is not a member of project",n.name||n.email)},e.renderUserBadge(n)))})},e.createMentionableTeam=function(e){return{value:Object(ae.a)(e.id),label:Object(Z.f)(ee.a,{team:e}),searchKey:"#".concat(e.slug),actor:{type:"team",id:e.id,name:e.slug}}},e.createUnmentionableTeam=function(t){var n=e.props.organization.access.includes("project:write");return oe(oe({},e.createMentionableTeam(t)),{},{disabled:!0,label:Object(Z.f)(he,null,Object(Z.f)(be,null,Object(Z.f)(te.a,{position:"left",title:Object(y.b)("%s is not a member of project","#".concat(t.slug))},Object(Z.f)(ee.a,{team:t}))),Object(Z.f)(te.a,{title:n?Object(y.b)("Add %s to project","#".concat(t.slug)):Object(y.b)("You do not have permission to add team to project.")},Object(Z.f)(ge,{size:"zero",borderless:!0,disabled:!n,onClick:e.handleAddTeamToProject.bind(L()(e),t),icon:Object(Z.f)(T.b,{isCircled:!0})})))})},e.handleChange=function(t){e.props.onChange(t)},e.handleInputChange=function(t){e.setState({inputValue:t}),e.props.onInputChange&&e.props.onInputChange(t)},e.queryMembers=W()((function(t,n){var a=e.props,r=a.api,i=a.organization;return r?r.requestPromise("/organizations/".concat(i.slug,"/members/"),{query:{query:t}}).then((function(e){return n(null,e)}),(function(e){return n(e)})):null}),250),e.handleLoadOptions=function(){var t=e.getMentionableUsers(),n=e.getMentionableTeams(),a=e.getTeamsNotInProject(n),r=t.map((function(e){return e.actor.id}));return new Promise((function(t,n){e.queryMembers(e.state.inputValue,(function(e,a){e?n(e):t(a)}))})).then((function(t){return t?t.filter((function(e){var t=e.user;return t&&-1===r.indexOf(t.id)})).map(e.createUnmentionableUser):[]})).then((function(e){return{options:[].concat(V()(t),V()(n),V()(a),V()(e))}}))},e}return l()(a,[{key:"componentDidUpdate",value:function(e){H()(this.props.projects,e.projects)||this.closeSelectMenu()}},{key:"getMentionableUsers",value:function(){return w.a.getAll().map(this.createMentionableUser)}},{key:"getMentionableTeams",value:function(){var e=this.props.project,t=x.a.getBySlug(e.slug);return t?t.teams.map(this.createMentionableTeam):[]}},{key:"getTeamsNotInProject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=ne.a.getAll()||[],n=e.map((function(e){return e.actor.id}));return t.filter((function(e){return-1===n.indexOf(e.id)})).map(this.createUnmentionableTeam)}},{key:"closeSelectMenu",value:function(){if(this.selectRef.current){var e=J.a.findDOMNode(this.selectRef.current),t=null==e?void 0:e.querySelector(".Select-input input");t&&t.blur()}}},{key:"handleAddTeamToProject",value:(t=z()(I.a.mark((function e(t){var n,a,r,i,l,o;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,a=n.api,r=n.organization,i=n.project,l=n.value,o=V()(l),this.props.onChange([].concat(V()(this.props.value),[this.createMentionableTeam(t)])),e.prev=3,e.next=6,Object(Y.a)(a,r.slug,i.slug,t);case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(3),this.props.onChange(o),this.closeSelectMenu();case 12:case"end":return e.stop()}}),e,this,[[3,8]])}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){return Object(Z.f)($,{deprecatedSelectControl:!0,filterOptions:function(e,t){return e.filter((function(e){return e.searchKey.indexOf(t)>-1}))},ref:this.selectRef,loadOptions:this.handleLoadOptions,defaultOptions:!0,async:!0,clearable:!0,disabled:this.props.disabled,cache:!1,valueComponent:se,placeholder:Object(y.b)("owners"),onInputChange:this.handleInputChange,onChange:this.handleChange,value:this.props.value,css:pe})}}]),a}(b.a.Component);de.displayName="SelectOwners";var fe=Object(re.a)(Object(ie.a)(de)),he=Object(f.a)("div",{target:"ewupek00",label:"Container"})({name:"gg4vpm",styles:"display:flex;justify-content:space-between;"}),be=Object(f.a)("div",{target:"ewupek01",label:"DisabledLabel"})({name:"1bjwb34",styles:"opacity:0.5;overflow:hidden;"}),ge=Object(f.a)(j.b,{target:"ewupek02",label:"AddToProjectButton"})({name:"6su6fj",styles:"flex-shrink:0;"});function me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Oe={text:"",tagName:"",type:"path",owners:[],isValid:!1};function ve(e){switch(e){case"path":return"src/example/*";case"url":return"https://example.com/settings/*";case"tag":return"tag-value";default:return""}}var je=function(e){c()(n,e);var t=me(n);function n(){var e;r()(this,n);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(e=t.call.apply(t,[this].concat(i))).state=Oe,e.checkIsValid=function(){e.setState((function(e){return{isValid:!!e.text&&e.owners&&!!e.owners.length}}))},e.handleTypeChange=function(t){e.setState({type:t}),e.checkIsValid()},e.handleTagNameChangeValue=function(t){e.setState({tagName:t.target.value},e.checkIsValid)},e.handleChangeValue=function(t){e.setState({text:t.target.value}),e.checkIsValid()},e.handleChangeOwners=function(t){e.setState({owners:t}),e.checkIsValid()},e.handleAddRule=function(){var t=e.state,n=t.type,a=t.text,r=t.tagName,i=t.owners;if(t.isValid){var l=i.map((function(e){var t;return"team"===e.actor.type?"#".concat(e.actor.name):null===(t=w.a.getById(e.actor.id))||void 0===t?void 0:t.email})).join(" "),o=a.match(/\s/)?'"'.concat(a,'"'):a,c="".concat("tag"===n?"tags.".concat(r):n,":").concat(o," ").concat(l);e.props.onAddRule(c),e.setState(Oe)}else Object(O.a)("A rule needs a type, a value, and one or more issue owners.")},e.handleSelectCandidate=function(t,n){e.setState({text:t,type:n}),e.checkIsValid()},e}return l()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.urls,a=t.paths,r=t.disabled,i=t.project,l=t.organization,o=this.state,c=o.type,s=o.text,u=o.tagName,p=o.owners,d=o.isValid;return Object(Z.f)(b.a.Fragment,null,(a||n)&&Object(Z.f)(ye,null,a&&a.map((function(t){return Object(Z.f)(Ce,{key:t,onClick:function(){return e.handleSelectCandidate(t,"path")}},Object(Z.f)(ke,{isCircled:!0}),Object(Z.f)(xe,null,t),Object(Z.f)(we,null,"[PATH]"))})),n&&n.map((function(t){return Object(Z.f)(Ce,{key:t,onClick:function(){return e.handleSelectCandidate(t,"url")}},Object(Z.f)(ke,{isCircled:!0}),Object(Z.f)(xe,null,t),Object(Z.f)(we,null,"[URL]"))}))),Object(Z.f)(Se,null,Object(Z.f)(Re,{deprecatedSelectControl:!0,name:"select-type",value:c,onChange:this.handleTypeChange,options:[{value:"path",label:Object(y.b)("Path")},{value:"tag",label:Object(y.b)("Tag")},{value:"url",label:Object(y.b)("URL")}],style:{width:140},clearable:!1,disabled:r}),"tag"===c&&Object(Z.f)(Ue,{value:u,onChange:this.handleTagNameChangeValue,disabled:r,placeholder:"tag-name"}),Object(Z.f)(Te,{value:s,onChange:this.handleChangeValue,disabled:r,placeholder:ve(c)}),Object(Z.f)(Pe,{direction:"right"}),Object(Z.f)(Ae,null,Object(Z.f)(fe,{organization:l,project:i,value:p,onChange:this.handleChangeOwners,disabled:r})),Object(Z.f)(Ie,{priority:"primary",disabled:!d,onClick:this.handleAddRule,icon:Object(Z.f)(T.b,{isCircled:!0}),size:"small"})))}}]),n}(b.a.Component);je.displayName="RuleBuilder";var ye=Object(f.a)("div",{target:"en2gln10",label:"Candidates"})({name:"1r2f04i",styles:"margin-bottom:10px;"}),we=Object(f.a)("div",{target:"en2gln11",label:"TypeHint"})("color:",(function(e){return e.theme.border}),";"),xe=Object(f.a)(R.a,{target:"en2gln12",label:"StyledTextOverflow"})({name:"1rr4qq7",styles:"flex:1;"}),Ce=Object(f.a)("div",{target:"en2gln13",label:"RuleCandidate"})("font-family:",(function(e){return e.theme.text.familyMono}),";border:1px solid ",(function(e){return e.theme.border}),";background-color:#f8fafd;padding-left:5px;margin-bottom:3px;cursor:pointer;overflow:hidden;display:flex;align-items:center;"),ke=Object(f.a)(T.b,{target:"en2gln14",label:"StyledIconAdd"})("color:",(function(e){return e.theme.border}),";margin-right:5px;flex-shrink:0;"),Se=Object(f.a)("div",{target:"en2gln15",label:"BuilderBar"})("display:flex;height:40px;align-items:center;margin-bottom:",Object(U.a)(2),";"),Re=Object(f.a)(S.a,{target:"en2gln16",label:"BuilderSelect"})("margin-right:",Object(U.a)(1.5),";width:50px;flex-shrink:0;"),Te=Object(f.a)(P.a,{target:"en2gln17",label:"BuilderInput"})("padding:",Object(U.a)(1),";line-height:19px;margin-right:",Object(U.a)(.5),";"),Ue=Object(f.a)(P.a,{target:"en2gln18",label:"BuilderTagNameInput"})("padding:",Object(U.a)(1),";line-height:19px;margin-right:",Object(U.a)(.5),";width:200px;"),Pe=Object(f.a)(T.j,{target:"en2gln19",label:"Divider"})("color:",(function(e){return e.theme.border}),";flex-shrink:0;margin-right:5px;"),Ae=Object(f.a)("div",{target:"en2gln110",label:"SelectOwnersWrapper"})("display:flex;align-items:center;margin-right:",Object(U.a)(1),";"),Ie=Object(f.a)(j.b,{target:"en2gln111",label:"AddButton"})("padding:",Object(U.a)(.5),";"),Me=je;function ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Ne=function(e){c()(n,e);var t=ze(n);function n(){var e;r()(this,n);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(e=t.call.apply(t,[this].concat(i))).state={hasChanges:!1,text:"",error:null},e.handleUpdateOwnership=function(){var t=e.props,n=t.organization,a=t.project,r=e.state.text;e.setState({error:null});var i=(new v.a).requestPromise("/projects/".concat(n.slug,"/").concat(a.slug,"/ownership/"),{method:"PUT",data:{raw:r||""}});return i.then((function(){Object(O.d)(Object(y.b)("Updated issue ownership rules")),e.setState({hasChanges:!1,text:r})})).catch((function(t){e.setState({error:t.responseJSON}),403===t.status?Object(O.a)(Object(y.b)("You don't have permission to modify issue ownership rules for this project")):400===t.status&&t.responseJSON.raw&&t.responseJSON.raw[0].startsWith("Invalid rule owners:")?Object(O.a)(Object(y.b)("Unable to save issue ownership rule changes: "+t.responseJSON.raw[0])):Object(O.a)(Object(y.b)("Unable to save issue ownership rule changes"))})),i},e.handleChange=function(t){e.setState({hasChanges:!0,text:t.target.value})},e.handleAddRule=function(t){var n=e.props.initialText;e.setState((function(e){return{text:(e.text||n)+"\n"+t}}),e.handleUpdateOwnership)},e}return l()(n,[{key:"parseError",value:function(e){var t,n,a,r=null==e?void 0:null===(t=e.raw)||void 0===t?void 0:t[0];return r?r.startsWith("Invalid rule owners:")?Object(Z.f)(Le,null,r):Object(Z.f)(Be,{line:parseInt(null!==(n=null===(a=r.match(/line (\d*),/))||void 0===a?void 0:a[1])&&void 0!==n?n:"",10)-1}):null}},{key:"mentionableUsers",value:function(){return w.a.getAll().map((function(e){return{id:e.id,display:e.email,email:e.email}}))}},{key:"mentionableTeams",value:function(){var e=this.props.project,t=x.a.getBySlug(e.slug);return t?t.teams.map((function(e){return{id:e.id,display:"#".concat(e.slug),email:e.id}})):[]}},{key:"render",value:function(){var e=this,t=this.props,n=t.project,a=t.organization,r=t.disabled,i=t.urls,l=t.paths,o=t.initialText,c=this.state,s=c.hasChanges,u=c.text,p=c.error;return Object(Z.f)(b.a.Fragment,null,Object(Z.f)(Me,{urls:i,paths:l,organization:a,project:n,onAddRule:this.handleAddRule.bind(this),disabled:r}),Object(Z.f)("div",{style:{position:"relative"},onKeyDown:function(t){t.metaKey&&"Enter"===t.key&&e.handleUpdateOwnership()}},Object(Z.f)(qe,{placeholder:"#example usage\npath:src/example/pipeline/* person@sentry.io #infra\nurl:http://example.com/settings/* #product\ntags.sku_class:enterprise #enterprise",onChange:this.handleChange,disabled:r,value:u||o,spellCheck:"false",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",theme:k.b}),Object(Z.f)(Ve,null,Object(Z.f)("div",null,this.parseError(p)),Object(Z.f)(De,null,Object(Z.f)(j.b,{size:"small",priority:"primary",onClick:this.handleUpdateOwnership,disabled:r||!s},Object(y.b)("Save Changes"))))))}}]),n}(b.a.Component);Ne.displayName="OwnerInput",Ne.defaultProps={urls:[],paths:[],disabled:!1};var Ve=Object(f.a)("div",{target:"e1v4gca20",label:"ActionBar"})({name:"1lekzkb",styles:"display:flex;align-items:center;justify-content:space-between;"}),Be=Object(f.a)("div",{target:"e1v4gca21",label:"SyntaxOverlay"})(C.a,";width:100%;height:",24,"px;background-color:red;opacity:0.1;pointer-events:none;position:absolute;top:",(function(e){return 4+24*e.line}),"px;"),De=Object(f.a)("div",{target:"e1v4gca22",label:"SaveButton"})({name:"1lifesv",styles:"text-align:end;padding-top:10px;"}),qe=Object(f.a)(m.a,{target:"e1v4gca23",label:"StyledTextArea"})(C.a,";min-height:140px;overflow:auto;outline:0;width:100%;resize:none;margin:0;font-family:",(function(e){return e.theme.text.familyMono}),";word-break:break-all;white-space:pre-wrap;padding-top:",4,"px;line-height:",24,"px;"),Le=Object(f.a)("div",{target:"e1v4gca24",label:"InvalidOwners"})("color:",(function(e){return e.theme.error}),";font-weight:bold;margin-top:12px;");t.a=Ne}}]);
//# sourceMappingURL=CreateOwnershipRuleModal~ProjectOwnership.js.map