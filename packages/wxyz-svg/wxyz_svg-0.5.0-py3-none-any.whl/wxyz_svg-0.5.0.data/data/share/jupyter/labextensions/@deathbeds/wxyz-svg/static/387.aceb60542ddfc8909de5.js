(self.webpackChunk_deathbeds_wxyz_svg=self.webpackChunk_deathbeds_wxyz_svg||[]).push([[387],{387:(e,t,o)=>{"use strict";o.r(t),o.d(t,{SVGBoxModel:()=>g,SVGBoxView:()=>u});var s=o(983),i=o(139),n=o(607),l=o(817),a=o(657),h=o.n(a),r=o(81);const d="jp-WXYZ-SVG-Layout",c="jp-WXYZ-SVG-zoom-lock",m="jp-WXYZ-SVG-Zoom";class g extends s.BoxModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:g.model_name,_model_module:i.A,_model_module_version:i.q,_view_name:g.view_name,_view_module:i.A,_view_module_version:i.q,svg:"<svg></svg>",zoom_lock:!1})}saveZoom(e){const{x:t,y:o,k:s}=this._lastZoom||{};return!(this._lastZoom&&t===e.x&&o===e.y&&s==e.k||(this.set({zoom_x:e.x,zoom_y:e.y,zoom_k:e.k}),this.save_changes(),this._lastZoom=e,0))}}g.model_name="SVGBoxModel",g.model_module=i.A,g.model_module_version=i.q,g.view_name="EditorView",g.view_module=i.A,g.view_module_version=i.q;class _ extends r.JupyterPhosphorPanelWidget{onResize(e){super.onResize(e),this._view.resize()}}class u extends s.BoxView{constructor(){super(...arguments),this._parser=new DOMParser}_createElement(e){return this.pWidget=new _({view:this}),this.pWidget.node}initialize(e){this._d3=n.select(this.el).style("position","relative").style("text-align","center"),n.select(window).on("",h().bind(this.update,this)),this.pWidget.addClass("jp-WXYZ-SVG"),this.model.on("change:svg change:area_attr",this.loadSVG,this),this.model.on("change:zoom_lock",this.zoomLock,this),this.model.on("change:zoom_x change:zoom_y change:zoom_k",this.onZoom,this),super.initialize(e),this.update(e),setTimeout((()=>this.resize()),11)}zoomLock(){this.model.get("zoom_lock")?this.pWidget.addClass(c):this.pWidget.removeClass(c)}onZoom(){this._zoomer&&this._zoomer.call(this._zoom.transform,l.zoomIdentity.translate(this.model.get("zoom_x"),this.model.get("zoom_y")).scale(this.model.get("zoom_k")))}update(e){this.layout(),super.update(e)}layout(){this.el.parentNode?(this._lastSVG!==this.model.get("svg")&&this.loadSVG(),this.resize()):h().delay(h().bind(this.layout,this),10)}addZoom(e){return e.replace(/(<svg(.|\n)*?>)/g,`$1\n<g class="${m}">`).replace("</svg>","</g>\n</svg>")}loadSVG(){const e=this,t=this.el.parentNode,o=this.model.get("area_attr");this._lastSVG=this.model.get("svg");const s=this._d3.selectAll(d).data([1]);s.remove(),this._zoom=null,s.enter().call((function(){const i=e._parser.parseFromString(e.addZoom(e._lastSVG),"image/svg+xml"),l=document.importNode(i.documentElement,!0),a=e._d3.insert((()=>l),":first-child").classed(d,!0);e._zoomer=a.select(`.${m}`);const h=s.selectAll("g").filter((function(){return this.parentNode===a.node()&&null!=n.select(this).attr(`:${o}`)})),r=s.append("g").attr("id",`${d}-ROOT-${e.cid}`);h.each((function(){r.node().appendChild(this)})),e._original={height:parseInt(a.attr("height"),10),width:parseInt(a.attr("width"),10)},s.attr("width",t.clientWidth).attr("height",t.clientHeight)})),this.resize()}patternToRegexp(e){if(null==e)return/.*/;try{return new RegExp(e.replace(".","\\.").replace("*",".*"))}catch(e){return null}}resize(){if(!this._original)return;const e=this._d3.select(`.${d}`),t=this;this._zoom||(this._zoom=l.zoom().on("zoom",(function({transform:e}){t._zoomer.attr("transform",e),t.model.saveZoom(e)})),e.call(this._zoom));const o=this.el.parentNode;if(!o)return;const s=document.documentElement,i=this._original.width/this._original.height,a=t.model.get("area_widgets"),r=this.model.get("visible_areas").map(this.patternToRegexp).filter(Object);let c=Math.min(o.clientWidth,s.clientWidth),m=c/i,g=c/this._original.width,_={},u=this.model.get("area_attr");g*this._original.height>s.clientHeight&&(g=s.clientHeight/this._original.height,m=s.clientHeight,c=m*i),e.attr("width",c).attr("height",m).style("opacity",this.model.get("show_svg")?1:0).select(`#${d}-ROOT-${t.cid}`).attr("transform",`scale(${g})`);const p=e.selectAll("g"),z=p.filter((function(){const e=n.select(this).attr(`:${u}`);return e&&r.find((t=>e.match(t)))}));p.each((function(){const e=this,t=n.select(e),o=t.attr(`:${u}`),s=z._groups.indexOf(e)>-1||h().some(z._groups[0],(t=>e.contains(t)));o&&s&&(_[o]=e),t.style("display",s?"inline":"none")}));const f=t.el.getBoundingClientRect(),v=t.model.get("children");h()(a).forIn((function(e,o){const s=v[e];let i=t.patternToRegexp(o);if(!i)return;const l=h()(_).find(((e,t)=>t.match(i))),a=l&&l.getBoundingClientRect();l?(["width","height"].map((function(e){s.has(e)&&s.set(e,a[e])})),h()(s.views).forIn((function(e){e.then((function(e){n.select(e.el).style("position","absolute").style("display",null).style("opacity",1).style("top",a.top-f.top+"px").style("left",a.left-f.left+"px").style("width",`${a.width}px`).style("height",`${a.height}px`),e.touch()})).catch(console.warn)}))):h()(s.views).forIn((function(e){e.then((e=>{n.select(e.el).style("display","none")})).catch(console.warn)}))}))}}}}]);