{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./df_websockets/forms.ts","webpack:///./df_websockets/app.js","webpack:///./df_websockets/base.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","serializeForm","form","serialized","elements","length","field","disabled","type","files","push","selectedOptions","checked","setFormInputValue","selector","document","querySelectorAll","forEach","tagName","options","Array","isArray","j","selected","addEventListener","evt","window","setTimeout","target","JSON","parse","getAttribute","signal","eventName","on","prevent","opts","DFSignals","preventDefault","DOMContentAdded","connection","buffer","registry","wsurl","websocketConnect","dfWsURL","cname","ca","decodeURIComponent","cookie","split","charAt","substring","indexOf","getCookie","console","info","WebSocket","onopen","send","onmessage","e","debug","data","msg","signal_id","onerror","error","onclose","id","undefined","stringify","connect","fn","elt","classList","add","class_name","insertAdjacentElement","content","append","firstChild","removeChild","insertBefore","parent","parentNode","removeAttribute","attr_name","remove","outerHTML","setAttribute","attr_value","innerHTML","textContent","save","createElement","href","url","download","filename","MouseEvent","view","bubbles","cancelable","dispatchEvent","URL","webkitURL","revokeObjectURL","querySelector","focus"],"mappings":"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","file":"df_websockets/static/js/df_websockets.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","export function serializeForm(form) {\n    /*\n    Serialize a HTMLFormElement as a list of {name: <field name>, value: <field value>}\n    disabled/reset/submit/buttonf fields are ignored\n     */\n    var serialized = [];\n    // Loop through each field in the form\n    for (var i = 0; i < form.elements.length; i++) {\n        var field = form.elements[i];\n        // Respect the same rules as jQuery's serializeArray\n        if (!field.name || field.disabled || field.type === 'reset' || field.type === 'submit' || field.type === 'button') {\n            continue;\n        }\n        if (field.type === \"file\") { // just returns the name of selected files\n            for (var n = 0; n < field.files.length; n++) {\n                serialized.push({ name: field.name, value: field.files[n].name });\n            }\n        }\n        else if (field.type === 'select-multiple') { // get all selected options\n            for (var n = 0; n < field.selectedOptions.length; n++) {\n                serialized.push({ name: field.name, value: field.selectedOptions[n].value });\n            }\n        }\n        else if ((field.type !== 'checkbox' && field.type !== 'radio') || field.checked) {\n            serialized.push({ name: field.name, value: field.value });\n        }\n    }\n    return serialized;\n}\nexport function setFormInputValue(selector, value) {\n    /*\n    Change the current value of a form input (designed by a standard selector, like \"[name=title]\").\n\n    * if the input is a checkbox or a radio field, then its check state is changed\n    * if the field is a select field, then all options with the given value (can be a string or a list of strings)\n        are selected\n    * otherwise, the value of the field is set to the given value.\n     */\n    document.querySelectorAll(selector).forEach(function (field) {\n        if ((field.tagName === \"INPUT\") || (field.tagName == \"TEXTAREA\")) {\n            if ((field.type === \"checkbox\") || (field.type === \"radio\")) {\n                field.checked = !!value;\n            }\n            else {\n                field.value = value;\n            }\n        }\n        else if (field.tagName === \"SELECT\") {\n            var options = field.options;\n            if (Array.isArray(value)) {\n                for (var i = 0; i < options.length; i++) {\n                    for (var j = 0; j < value.length; j++) {\n                        if (options[i].value === value[j]) {\n                            options[i].selected = true;\n                        }\n                    }\n                }\n            }\n            else {\n                for (var i = 0; i < options.length; i++) {\n                    if (options[i].value === value) {\n                        options[i].selected = true;\n                    }\n                }\n            }\n        }\n    });\n}\nfunction DOMContentAdded(evt) {\n    /*\n    search all HTML elements with an attribute \"data-df-signal\" that contains a JSON list of Signal objects:\n    {\n        name: \"name of the signal to call\",  (required)\n        on: \"name of the listened event\",\n        opts: \"extra options\",               (optional)\n        form: \"name of option to add to opts that contains the serialized form\",  (optional)\n        value: \"name of option to add to opts that contains the value\",  (optional)\n        prevent: preventDefault               (optional, defaults to true for on==\"submit\" or \"click\" else false )\n    }\n\n    When the listened event is not given, the listened event is\n        * \"submit\" for forms,\n        * \"click\" for \"reset\"/\"submit\"/\"button\" input fields,\n        * \"change\" for other fields.\n\n    Using on a HTML form:\n    ```html\n    <form data-df-signal='[{\"name\": \"signal.name\", \"on\": \"change\", \"form\": \"form_data\", \"opts\": {\"id\": 42} }]'>\n        <input type=\"text\" name=\"title\" value=\"df_websockets\">\n    </form>```\n    or, using the Django templating system:\n    ```html\n    {% load df_websockets %}\n    <form {% js_call \"signal.name\" on=\"change\" form=\"form_data\" id=42 %}>\n        <input type=\"text\" name=\"title\" value=\"df_websockets\">\n    </form>```\n\n    When the field \"title\" is modified, a signal \"signal.name\" is triggered on the server (via the websocket) with\n    the following arguments:\n    ```python\n    form_data = [{\"name\": \"title\", \"value\": \"df_websockets\"}]\n    id = 42\n    ```\n\n    Using on a HTML form input field:\n    ```html\n    <form>\n        <input type=\"text\" name=\"title\" data-df-signal='[{\"name\": \"signal.name\", \"on\": \"change\", \"value\": \"title\", \"opts\": {\"id\": 42} }]'>\n    </form>```\n    or, using the Django templating system:\n    ```html\n    {% load df_websockets %}\n    <form>\n        <input type=\"text\" name=\"title\" {% js_call \"signal.name\" on=\"change\" value=\"title\" id=42 %}>\n    </form>```\n\n    When the field \"title\" is modified, a signal \"signal.name\" is triggered on the server (via the websocket) with\n    the following arguments:\n    ```python\n    title = \"new title value\"\n    id = 42\n    ```\n     */\n    evt.target.querySelectorAll(\"[data-df-signal]\").forEach(function (target) {\n        var signals = JSON.parse(target.getAttribute(\"data-df-signal\"));\n        signals.forEach(function (signal) {\n            var eventName = signal.on;\n            if (!eventName) {\n                if (target.tagName === \"FORM\") {\n                    eventName = \"submit\";\n                }\n                else if ((target.tagName === \"INPUT\" && !(target.type === 'reset' || target.type === 'submit' || target.type === 'button')) || (target.tagName === \"TEXTAREA\")) {\n                    eventName = \"change\";\n                }\n                else {\n                    eventName = \"click\";\n                }\n            }\n            var callback = function (evt) {\n                // noinspection JSUnresolvedVariable\n                var prevent = signal.prevent;\n                var opts = signal.opts || {};\n                if (signal.form) {\n                    opts[signal.form] = serializeForm(target);\n                }\n                if (signal.value) {\n                    if (target.type === \"file\") { // just returns the name of selected files\n                        opts[signal.value] = [];\n                        for (var n = 0; n < target.files.length; n++) {\n                            opts[signal.value].push(target.files[n].name);\n                        }\n                    }\n                    else if (target.type === 'select-multiple') { // get all selected options\n                        opts[signal.value] = [];\n                        for (var n = 0; n < target.selectedOptions.length; n++) {\n                            opts[signal.value].push(target.selectedOptions[n].value);\n                        }\n                    }\n                    else if (target.type === 'checkbox' || target.type === 'radio') {\n                        opts[signal.value] = target.checked;\n                    }\n                    else {\n                        opts[signal.value] = target.value;\n                    }\n                }\n                window.DFSignals.call(signal.name, opts);\n                if (prevent === true || (prevent === null && eventName !== \"change\")) {\n                    evt.preventDefault();\n                }\n            };\n            target.addEventListener(eventName, callback);\n        });\n    });\n}\ndocument.addEventListener(\"DOMContentAdded\", function (evt) {\n    window.setTimeout(function () {\n        DOMContentAdded(evt);\n    }, 200);\n    // awful trick for being sure that our addEventListener is the last.\n    // allows things like CKEditor to push its content to the textarea before sending the content of the form.\n});\n","////////////////////////////////////////////////////////////////////////////////\n// This file is part of df_websockets                                          /\n//                                                                             /\n// Copyright (C) 2020 Matthieu Gallet <github@19pouces.net>                    /\n// All Rights Reserved                                                         /\n//                                                                             /\n// You may use, distribute and modify this code under the                      /\n// terms of the (BSD-like) CeCILL-B license.                                   /\n//                                                                             /\n// You should have received a copy of the CeCILL-B license with                /\n// this file. If not, please visit:                                            /\n// https://cecill.info/licences/Licence_CeCILL-B_V1-en.txt (English)           /\n// or https://cecill.info/licences/Licence_CeCILL-B_V1-fr.txt (French)         /\n//                                                                             /\n////////////////////////////////////////////////////////////////////////////////\n\nwindow.DFSignals = {\n    connection: null,\n    buffer: [],\n    registry: {},\n    wsurl: null\n};\n\nfunction getCookie(cname) {\n    const name = cname + \"=\";\n    const decodedCookie = decodeURIComponent(document.cookie);\n    const ca = decodedCookie.split(';');\n    for (let i = 0; i < ca.length; i++) {\n        let c = ca[i];\n        while (c.charAt(0) === ' ') {\n            c = c.substring(1);\n        }\n        if (c.indexOf(name) === 0) {\n            return c.substring(name.length, c.length);\n        }\n    }\n    return \"\";\n}\n\nfunction websocketConnect() {\n    const cookieName = \"dfwsurl\";\n    if (window.DFSignals.wsurl === null) {\n        const dfWsURL = getCookie(cookieName);\n        window.DFSignals.wsurl = decodeURIComponent(dfWsURL);\n    }\n    if (!window.DFSignals.wsurl) {\n        console.info(\"Unable to get the websocket URL in the '\" + cookieName + \"' cookie.\");\n        return;\n    }\n    const connection = new WebSocket(window.DFSignals.wsurl);\n    /* cannot use header or cookies (cookies may change after the initial connection)\n    *  so we use GET parameter\n    *  */\n    connection.onopen = () => {\n        window.DFSignals.connection = connection;\n        for (let i = 0; i < window.DFSignals.buffer.length; i++) {\n            connection.send(window.DFSignals.buffer[i]);\n        }\n        window.DFSignals.buffer = [];\n    };\n    connection.onmessage = (e) => {\n        console.debug('received call ' + e.data + ' from server.')\n        const msg = JSON.parse(e.data);\n        // noinspection JSUnresolvedVariable\n        if (msg.signal && msg.signal_id) {\n            window.DFSignals.call(msg.signal, msg.opts, msg.signal_id);\n        }\n    };\n    connection.onerror = (e) => {\n        console.error(\"WS error: \" + e);\n    };\n    connection.onclose = () => {\n        window.DFSignals.connection = null;\n        setTimeout(websocketConnect, 3000);\n    }\n}\n\nfunction call(signal, opts, id) {\n    /*\"\"\"\n    .. function:: call(signal, opts, id)\n\n        Call a signal.\n        If the signal is also defined in the Python server and available to the user, then the Python signal is also triggered.\n\n        :param string signal: Name of the called signal.\n        :param object opts: Object with signal arguments.\n        :param string id: Unique id of each signal triggered by the server. Do not use it yourself.\n        :returns: always `false`.\n    */\n    // if (window.DFSignals.registry[signal] === undefined) {\n    //     console.debug('unknown call \"' + signal + '\" (from both client and server).');\n    //     return false;\n    // } else\n    if ((id !== undefined) && (window.DFSignals.registry[id] !== undefined)) {\n        return false;\n    } else if (id !== undefined) {\n        window.DFSignals.registry[id] = true;\n    }\n    if (window.DFSignals.registry[signal] !== undefined) {\n        console.debug('call \"' + signal + '\"', opts);\n        for (let i = 0; i < window.DFSignals.registry[signal].length; i += 1) {\n            window.DFSignals.registry[signal][i](opts, id);\n        }\n    }\n    if (id === undefined) {\n        console.debug('call from client: \"' + signal + '\"', opts);\n        const msg = JSON.stringify({signal: signal, opts: opts});\n        if (window.DFSignals.connection) {\n            window.DFSignals.connection.send(msg);\n        } else {\n            window.DFSignals.buffer.push(msg);\n        }\n    }\n\n    return false;\n}\n\nfunction connect(signal, fn) {\n    /*\"\"\"\n    .. function:: connect(signal, fn)\n\n        Connect a javascript code to the given signal name.\n\n        :param string signal: Name of the signal.\n        :param function fn: Function that takes a single object as argument. The properties of this object are the signal arguments.\n        :returns: nothing.\n    */\n    if (window.DFSignals.registry[signal] === undefined) {\n        window.DFSignals.registry[signal] = [];\n    }\n    window.DFSignals.registry[signal].push(fn);\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", websocketConnect);\n\nwindow.DFSignals.call = call;\nwindow.DFSignals.connect = connect;\n","////////////////////////////////////////////////////////////////////////////////\n// This file is part of df_websockets                                          /\n//                                                                             /\n// Copyright (C) 2020 Matthieu Gallet <github@19pouces.net>                    /\n// All Rights Reserved                                                         /\n//                                                                             /\n// You may use, distribute and modify this code under the                      /\n// terms of the (BSD-like) CeCILL-B license.                                   /\n//                                                                             /\n// You should have received a copy of the CeCILL-B license with                /\n// this file. If not, please visit:                                            /\n// https://cecill.info/licences/Licence_CeCILL-B_V1-en.txt (English)           /\n// or https://cecill.info/licences/Licence_CeCILL-B_V1-fr.txt (French)         /\n//                                                                             /\n////////////////////////////////////////////////////////////////////////////////\n\nimport {setFormInputValue} from \"./forms\";\n\nfunction connectSignals() {\n\n    // noinspection ES6ModulesDependencies\n    window.DFSignals.connect('html.add_class', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            // noinspection JSUnresolvedVariable\n            elt.classList.add(opts.class_name)\n        });\n    });\n    /*\"\"\"\n    .. function:: html.add_class(opts)\n\n        Adds the specified class(es) to each of the set of matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.add_class', {selector: \"#obj\", class_name: \"myclass\"});\n\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.add_class', to=WINDOW, selector=\"#obj\", class_name=\"myclass\")\n\n\n        :param string selector: HTML selector\n        :param string class_name: new class\n\n    */\n\n    window.DFSignals.connect('html.after', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.insertAdjacentElement('afterend', opts.content)\n        });\n    });\n    /*\"\"\"\n    .. function:: html.after(opts)\n\n        Insert content, specified by the parameter, after each element in the set of matched elements..\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.after', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.after', to=WINDOW, selector=\"#obj\", content=\"<span>hello</span>\")\n\n        :param string selector: HTML selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.append', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.append(opts.content)\n        });\n    });\n    /*\"\"\"\n    .. function:: html.append(opts)\n\n        Insert content, specified by the parameter, to the end of each element in the set of matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.append', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.append', to=WINDOW, selector=\"#obj\", content=\"<span>hello</span>\")\n\n        :param string selector: HTML selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.before', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.insertAdjacentElement('beforebegin', opts.content)\n        });\n    });\n    /*\"\"\"\n    .. function:: html.before(opts)\n\n        Insert content, specified by the parameter, before each element in the set of matched elements..\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.before', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.before', to=WINDOW, selector=\"#obj\", content=\"<span>hello</span>\")\n\n        :param string selector: HTML selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.empty', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            while (elt.firstChild) {\n                elt.removeChild(elt.firstChild);\n            }\n        });\n    });\n    /*\"\"\"\n    .. function:: html.empty(opts)\n\n        Remove all child nodes of the set of matched elements from the DOM.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.empty', {selector: \"#obj\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.empty', to=WINDOW, selector=\"#obj\")\n\n        :param string selector: HTML selector\n\n    */\n\n    window.DFSignals.connect('html.prepend', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.insertBefore(opts.content, parent.firstChild);\n        });\n    });\n    /*\"\"\"\n    .. function:: html.prepend(opts)\n\n        Insert content, specified by the parameter, to the beginning of each element in the set of matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.prepend', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.prepend', to=WINDOW, selector=\"#obj\", content=\"<span>hello</span>\")\n\n        :param string selector: HTML selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.remove', opts => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.parentNode.removeChild(elt)\n        });\n    });\n    /*\"\"\"\n    .. function:: html.remove(opts)\n\n        Remove the set of matched elements from the DOM.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.remove', {selector: \"#obj\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.remove', to=WINDOW, selector=\"#obj\")\n\n        :param string selector: HTML selector\n\n    */\n    window.DFSignals.connect('html.remove_attr', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            // noinspection JSUnresolvedVariable\n            elt.removeAttribute(opts.attr_name);\n        });\n    });\n    /*\"\"\"\n    .. function:: html.remove_attr(opts)\n\n        Remove an attribute from each element in the set of matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.remove_attr', {selector: \"#obj\", attr_name: \"attr\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.remove_attr', to=WINDOW, selector=\"#obj\", attr_name=\"attr\")\n\n        :param string selector: HTML selector\n        :param string attr_name: attribute to remove\n\n    */\n    window.DFSignals.connect('html.remove_class', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            // noinspection JSUnresolvedVariable\n            elt.classList.remove(opts.class_name);\n        });\n    });\n    /*\"\"\"\n    .. function:: html.remove_class(opts)\n\n        Remove a single class, multiple classes, or all classes from each element in the set of matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.remove_class', {selector: \"#obj\", class_name: \"class\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.remove_class', to=WINDOW, selector=\"#obj\", class_name=\"attr\")\n\n        :param string selector: HTML selector\n        :param string class_name: class to remove\n\n    */\n    window.DFSignals.connect('html.replace_with', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.outerHTML = opts.content;\n        });\n    });\n    /*\"\"\"\n    .. function:: html.replace_with(opts)\n\n        Replace each element in the set of matched elements with the provided new content.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.replace_with', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.replace_with', to=WINDOW, selector=\"#obj\", content=\"<span>hello</span>\")\n\n        :param string selector: HTML selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.add_attribute', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            // noinspection JSUnresolvedVariable\n            elt.setAttribute(opts.attr_name, opts.attr_value);\n        });\n    });\n    /*\"\"\"\n    .. function:: html.add_attribute(opts)\n\n        Add an attribute to each element matched by the given selector.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.add_attribute', {selector: \"#obj\", attr_name: \"data-df\", attr_value: \"value\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.add_attribute', to=WINDOW, selector=\"#obj\", attr_name=\"data-df\", attr_value= \"value\")\n\n\n        :param string selector: HTML selector\n        :param string attr_name: name of the attribute to add\n        :param string attr_value: value of the attribute to add\n\n    */\n\n    window.DFSignals.connect('html.content', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.innerHTML = opts.content;\n        });\n    });\n    /*\"\"\"\n    .. function:: html.content(opts)\n\n        set the HTML contents of every matched element.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.content', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.content', to=WINDOW, selector=\"#obj\", content= \"<span>hello</span>\")\n\n\n        :param string selector: HTML selector\n        :param string content: new HTML content\n    */\n\n\n    window.DFSignals.connect('html.text', (opts) => {\n        document.querySelectorAll(opts.selector).forEach(elt => {\n            elt.textContent = opts.content;\n        });\n    });\n    /*\"\"\"\n    .. function:: html.text(opts)\n\n        Set the text contents of the matched elements.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.text', {selector: \"#obj\", content: \"<span>hello</span>\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.text', to=WINDOW, selector=\"#obj\", content= \"<span>hello</span>\")\n\n\n        :param string selector: HTML selector\n        :param string content: new HTML content\n\n    */\n\n    window.DFSignals.connect('html.download_file', (opts) => {\n        /*\"\"\"\n        .. function:: html.download_file(opts)\n\n            Force the client to download the given file.\n\n            .. code-block:: javascript\n\n                window.DFSignals.call('html.download_file', {url: \"http://example.org/test.zip\", filename: \"test.zip\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.download_file', to=WINDOW, url=\"http://example.org/test.zip\", filename=\"test.zip\")\n\n            :param string url: URL of the file\n            :param string filename: name of the file\n\n        */\n        const save = document.createElement('a');\n        save.href = opts.url;\n        save.target = '_blank';\n        save.download = opts.filename || 'unknown';\n        const evt = new MouseEvent('click', {view: window, bubbles: true, cancelable: false});\n        save.dispatchEvent(evt);\n        (window.URL || window.webkitURL).revokeObjectURL(save.href);\n    });\n\n\n    window.DFSignals.connect('html.focus', (opts) => {\n        const elt = document.querySelector(opts.selector);\n        if (elt) {\n            elt.focus();\n        }\n    });\n    /*\"\"\"\n    .. function:: html.focus(opts)\n\n        Set the focus to the matched element.\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.focus', {selector: \"#obj\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.focus', to=WINDOW, selector=\"#obj\")\n\n        :param string selector: HTML selector\n\n    */\n    \n    window.DFSignals.connect('html.forms.set', (opts) => {\n        setFormInputValue(opts.selector, opts.value);\n    });\n    /*\"\"\"\n    .. function:: html.forms.set(opts)\n\n        Set the value of a form input\n\n        .. code-block:: javascript\n\n            window.DFSignals.call('html.forms.set', {selector: \"[name=title]\", value: \"new title\"});\n\n        .. code-block:: python\n\n            trigger(window_info, 'html.forms.set', to=WINDOW, selector=\"[name=title]\", value=\"new_title\")\n\n        :param string selector: HTML selector\n\n    */}\n\ndocument.addEventListener(\"DOMContentLoaded\", connectSignals);\n"],"sourceRoot":""}