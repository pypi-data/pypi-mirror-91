(self.webpackChunk_deathbeds_wxyz_datagrid=self.webpackChunk_deathbeds_wxyz_datagrid||[]).push([[330,573],{330:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CellRendererModel:()=>b.Uy,DataGridModel:()=>d,DataGridView:()=>a,FixedFuncModel:()=>b.CI,FormatFuncModel:()=>b.eR,GridStyleModel:()=>p,SelectGridModel:()=>x,SelectGridView:()=>M,StyleGridModel:()=>S,StyleGridView:()=>y,TextRendererModel:()=>b.vI});var s=i(983),o=i(795),l=i(81),r=i(753),n=i(574);class d extends r.WXYZBox{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:d.model_name,_view_name:d.view_name})}}d.model_name="DataGridModel",d.view_name="DataGridView",d.serializers=Object.assign(Object.assign({},r.WXYZBox.serializers),{cell_renderers:{deserialize:l.unpack_models}});class a extends s.BoxView{initialize(e){super.initialize(e);const t=e.createGrid||this.createGrid;super.initialize(e),this._grid=t(),this.addGridBehaviors(this._grid),this._grid.view=this,this.model.on("change:value",this.onValue,this),this.pWidget.addWidget(this._grid),this.pWidget.addClass("jp-WXYZ-DataGrid"),this.onValue()}createGrid(){return new o.DataGrid}addGridBehaviors(e){e.keyHandler=new o.BasicKeyHandler,e.mouseHandler=new o.BasicMouseHandler}onValue(){const e=this.model.get("value");e?(this._grid.dataModel=new n.h(e),this._grid.dataModel.jmodel=this.model):this._grid.dataModel=null}}const c=["row_size","column_size","row_header_size","column_header_size"],h=["backgroundColor","columnBackgroundColor","cursorBorderColor","cursorFillColor","gridLineColor","headerBackgroundColor","headerGridLineColor","headerHorizontalGridLineColor","headerSelectionBorderColor","headerSelectionFillColor","headerVerticalGridLineColor","horizontalGridLineColor","rowBackgroundColor","scrollShadow","selectionBorderColor","selectionFillColor","verticalGridLineColor","voidColor"],u=h.reduce(((e,t)=>`${e} change:${t}`),""),g="rgba(0,0,0,0.0)";class m extends o.DataGrid{get view(){return this._view}set view(e){this._view=e,this.onSetView()}styleFunctor(e){const t=e.length;return i=>0==t?g:(i<t?e[i]:e[i%t])||g}someStyleChanged(e){const t=null==e?void 0:e.changed;let i={};if(t){for(const e of Object.keys(t)){const s=t[e];if(-1!==h.indexOf(e))switch(e){case"rowBackgroundColor":case"columnBackgroundColor":i[e]=s?this.styleFunctor(s):null;break;default:i[e]=s}}this.style=Object.assign(Object.assign({},this.style),i)}}onSetView(){const e=this.view.model;e.on("change:cell_renderers",this.onModelCellRenderers,this),e.on("change:grid_style",this.onGridStyle,this),e.on("change:header_visibility",this.onHeaderVisibility,this),e.on(c.map((e=>`change:${e}`)).join(" "),this.onModelSize,this),this.onModelCellRenderers(),this.onModelSize(),setTimeout((()=>{this.onGridStyle().then((()=>{this.someStyleChanged({changed:this.view.model.get("grid_style").attributes})})).catch(console.warn)}),100)}onGridStyle(){return e=this,t=void 0,s=function*(){let e=this.view.model.previousAttributes().style;if(null!=e)try{e.off(h,this.someStyleChanged,this)}catch(e){console.warn(e)}let t=this.view.model.get("grid_style");if("string"==typeof t){const e=this.view.model.widget_manager.get_model(t);try{t=yield e}catch(e){console.warn(e)}}if(null!=t){const e={};for(const i of h)if(null==t.get(i)){const t=this.style[i];null!=t&&(e[i]=t)}Object.keys(e)&&(t.set(e),t.save_changes()),t.on(u,this.someStyleChanged,this)}},new((i=void 0)||(i=Promise))((function(o,l){function r(e){try{d(s.next(e))}catch(e){l(e)}}function n(e){try{d(s.throw(e))}catch(e){l(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,n)}d((s=s.apply(e,t||[])).next())}));var e,t,i,s}setRenderer(e){const t={[e.get("region")||"body"]:e.toRenderer((()=>this.setRenderer(e)))};this.cellRenderers.update(t)}makeRenderers(){return this._view.model.get("cell_renderers").map((e=>({region:e.get("region")||"body",metadata:e.get("metadata")||{},renderer:e.toRenderer((()=>this.setRenderer(e))),model:e})))}onModelCellRenderers(){let e=this.makeRenderers();this.cellRenderers._values={},e.map((e=>{e.model&&e.model.on("change",(()=>this.setRenderer(e.model))),this.cellRenderers.update({[e.region]:e.renderer})})),e.length||this.cellRenderers.update()}onModelSize(){const e=this._view.model,t=Object.keys(e.changedAttributes()),i=Object.assign({},this.defaultSizes);for(const s of t){let t=e.get(s);if(null!=t)switch(s){default:continue;case"row_size":i.rowHeight=t;continue;case"row_header_size":i.rowHeaderWidth=t;continue;case"column_size":i.columnWidth=t;continue;case"column_header_size":i.columnHeaderHeight=t;continue}}this.defaultSizes=i}onHeaderVisibility(){this.headerVisibility=this.view.model.get("header_visibility")}}class _ extends m{constructor(){super(...arguments),this._scrollLock=!1}onBeforeAttach(e){["touchmove","mouseup"].forEach((e=>this.node.addEventListener(e,this))),super.onBeforeAttach(e)}scrollTo(e,t){if(super.scrollTo(e,t),this._scrollLock)return;const i=this._view.model,s=this._scrollX,o=this._scrollY,l=this.maxScrollX,r=this.maxScrollY,n=i.get("scroll_x"),d=i.get("scroll_y");n===s&&d===o||(this._view.model.set({scroll_x:s,scroll_y:o,max_x:l,max_y:r}),this.updateViewport(),this._view.touch())}onResize(e){super.onResize(e),this.updateViewport(),this._view.touch()}handleEvent(e){switch(super.handleEvent(e),e.type){default:break;case"touchmove":case"mousemove":this.updateHover(e);break;case"wheel":this.updateViewport()}this._view.model.changedAttributes()&&this._view.touch()}hoveredCell(e){const{offsetX:t,offsetY:i}=e,{headerWidth:s,headerHeight:o}=this,l=this._rowSections.indexOf(i-o+this.scrollY);return[this._columnSections.indexOf(t-s+this.scrollX),l]}viewExtent(){const{headerWidth:e,headerHeight:t,scrollX:i,scrollY:s}=this,o=this.rowSections,l=this.columnSections,r=i-e,n=s-t,d=l.indexOf(r)+1,a=o.indexOf(n)+1;return[d,l.indexOf(r+this.viewportWidth),a,o.indexOf(n+this.viewportHeight)]}updateViewport(){const[e,t,i,s]=this.viewExtent();this._view.model.set({viewport:[e,t,i,s]})}updateHover(e){const t=this._view.model,[i,s]=this.hoveredCell(e);t.set({hover_row:s,hover_column:i})}onSetView(){super.onSetView(),this.view.model.on("change:viewport",this.onModelViewport,this),this.view.model.on("change:scroll_x change:scroll_y",this.onModelScroll,this),this.onModelScroll(),this.onModelViewport()}onModelViewport(){const e=this.view.model,[t,i,s,o]=this.viewExtent();let[l,r,n,d]=e.get("viewport");t===l&&i===r&&s===n&&o===d||this.scrollTo(l*this.defaultSizes.columnWidth,n*this.defaultSizes.rowHeight)}onModelScroll(){const e=this.view.model;let t=e.get("scroll_x"),i=e.get("scroll_y");null!=t&&null!=i&&(this._scrollLock=!0,this.scrollTo(t,i),this._scrollLock=!1)}}var w=i(797),v=i(850),f=i(139);class p extends r.WXYZ{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:p.model_name,_model_module:f.A,_model_module_version:f.q})}}p.model_module=f.A,p.model_module_version=f.q,p.model_name="GridStyleModel";class S extends d{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:S.model_name,_view_name:S.view_name,grid_style:null,header_visibility:"all"})}}S.model_name="StyleGridModel",S.view_name="StyleGridView",S.serializers=Object.assign(Object.assign({},d.serializers),{grid_style:{deserialize:l.unpack_models}});class y extends a{createGrid(){return new m}initialize(e){e.createGrid=()=>this.createGrid(),super.initialize(e),this.pWidget.addClass("jp-WXYZ-StyleGrid")}}class x extends S{createGrid(){return new _}defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:x.model_name,_view_name:x.view_name})}}x.model_name="SelectGridModel",x.view_name="SelectGridView",x.serializers=Object.assign(Object.assign({},S.serializers),{selection:{deserialize:l.unpack_models}});class M extends y{constructor(){super(...arguments),this.isUpdatingSelections=!1}createGrid(){return new _}initialize(e){e.createGrid=()=>this.createGrid(),super.initialize(e),this.pWidget.addClass("jp-WXYZ-SelectGrid"),this.model.on("change:selections",this.onModelSelectionsChanged,this)}onValue(){this._grid.selectionModel&&this._grid.selectionModel.changed.disconnect(this.onGridSelectionChanged,this),super.onValue();const{dataModel:e}=this._grid;if(null!=e){const t=new o.BasicSelectionModel({dataModel:e});this._grid.selectionModel=t,this._grid.selectionModel.changed.connect(this.onGridSelectionChanged,this)}}onModelSelectionsChanged(){const e=this.model.get("selections"),t=this.gridSelectionToModel(),{selectionModel:i}=this._grid;if(null!=i&&!w.JSONExt.deepEqual(e,t)){this.isUpdatingSelections=!0,i.clear();for(const t of e){const[e,s,o,l]=t;i.select({c1:e,c2:s,r1:o,r2:l,cursorColumn:Math.min(e,s),cursorRow:Math.min(o,l),clear:"none"})}this.isUpdatingSelections=!1}}gridSelectionToModel(){const{selectionModel:e}=this._grid;let t=[];for(const i of(0,v.toArray)(e.selections())){const{c1:e,c2:s,r1:o,r2:l}=i;t.push([e,s,o,l])}return t}onGridSelectionChanged(){if(this.isUpdatingSelections)return;const{selectionModel:e}=this._grid,t=this.model.get("selections");let i;null!=e&&(i=this.gridSelectionToModel()),w.JSONExt.deepEqual(t,i)||(this.model.set({selections:i}),this.touch())}}var b=i(660)},660:(e,t,i)=>{"use strict";i.d(t,{Uy:()=>r,eR:()=>n,CI:()=>d,vI:()=>a});var s=i(795),o=i(81),l=i(753);class r extends l.WXYZ{toRenderer(e){return null}}r.model_name="CellRendererModel";class n extends l.WXYZ{toFormatFunc(){return null}}n.model_name="FormatFuncModel";class d extends n{toFormatFunc(){return s.TextRenderer.formatFixed({digits:this.get("digits"),missing:this.get("missing")})}}d.model_name="FixedFuncModel";class a extends r{toRenderer(e){let t;try{t=this.get("format_func"),e&&t.on("change",(()=>e()))}catch(e){}return new s.TextRenderer({textColor:()=>this.get("text_color"),backgroundColor:()=>this.get("background_color")||"",format:t?t.toFormatFunc():null,horizontalAlignment:()=>this.get("horizontal_alignment"),verticalAlignment:()=>this.get("vertical_alignment"),font:()=>this.get("font")})}}a.model_name="TextRendererModel",a.serializers=Object.assign(Object.assign({},r.serializers),{format_func:{deserialize:o.unpack_models}})},574:(e,t,i)=>{"use strict";i.d(t,{h:()=>o});var s=i(795);class o extends s.JSONModel{metadata(e,t,i){var s;return Object.assign({jmodel:null===(s=this.jmodel)||void 0===s?void 0:s.attributes},super.metadata(e,t,i))}}}}]);