(self.webpackChunkatoti_jupyterlab=self.webpackChunkatoti_jupyterlab||[]).push([[6527],{16527:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var l=s(39030),n=s(56271),a=s.n(n),o=s(53521),c=s(58527),r=s.n(c),i=s(98537),u=s.n(i),m=s(2689),p=s.n(m),d=s(95479),b=s(13423);const h=e=>{const t=[];return e.forEach((e=>{const s=e.name;t.includes(s)||(e.showlegend=!0,t.push(s))})),e};function y({cube:e,data:t,metaData:s,widgetState:{colors:l,isTextVisible:n,mapping:a,opacity:c=1}}){if(!e||!t||!s)return[];const r={},i={},m={mapping:{},numberOfUsedAutomaticColors:0},{attributesRedirection:b}=s,y=a.size.length>0;let g=0;const x=a.horizontalSubplots.length+a.verticalSubplots.length>0;(0,d.IG)(t,s.hierarchyIndicesInCellSet,(({cell:e,cellIndex:t,columnIndex:p,tuple:d,rowIndex:h})=>{const y=(0,o._F)(d,s.levelIndicesPerField,a,b),x=[...y.color,...y.horizontalSubplots,...y.verticalSubplots],I=y.splitBy,f=(0,o.Lj)(x),v=(0,o.Lj)(I),w=e.value,k=(({membersPerAttribute:e,pointKey:t,traceKey:a})=>(i[a]||(i[a]=function({traceKey:e,membersPerAttribute:t}){const a=(0,o.Ym)(t.color,0),r=Object.values(i).some((e=>e.name===a)),u=(0,o.he)({accumulator:m,colorway:s.colorway,colors:l,traceName:a});return{_key:e,hoverinfo:"none",legendgroup:a,mode:n?"text+markers":"markers",name:a,cellsIndices:[],showlegend:!r,text:[],textposition:"top center",type:"scatter",marker:{size:[],color:u},x:[],y:[],opacity:c}}({traceKey:a,membersPerAttribute:e})),u()(r,{[a]:{[t]:{}}}),r[a][t]))({membersPerAttribute:y,traceKey:f,pointKey:v});if(k.cellsIndices||(k.cellsIndices=[]),k.cellsIndices.push({rowIndex:h,columnIndex:p,cellIndex:t}),y.xValues.length>0)k.x=w;else if(y.yValues.length>0)k.y=w;else if(y.size.length>0){const e=Math.abs(w);k.size=e,e>g&&(g=e)}y.splitBy.length>0&&(k.text=(0,o.KT)(y.splitBy))})),Object.entries(i).forEach((([e,t])=>{const s=r[e];y||(t.marker.size=15),Object.values(s).forEach((e=>{const{cellsIndices:s,x:l,y:n,size:a,text:o}=e;t.cellsIndices.push(s),t.x.push(l),t.y.push(n),t.text.push(o),y&&t.marker.size.push(100*a/g)}))}));const I=Object.values(i);if(I.forEach((e=>{var t;e.axisIndices=p()(null===(t=e.x)||void 0===t?void 0:t.length)})),x){const e=s.subplots,t=(0,o.$)({traces:I,subplotsMetaData:e});return(0,o.Mr)(t,e),h(t),t}return h(I),I}const g=(0,o.i)((0,o.H9)((0,n.memo)((e=>{const{cube:t,data:s,metaData:c,widgetState:i,onLoaded:u}=e,m=(0,n.useMemo)((()=>(0,l.TS)(null==i?void 0:i.mapping)),[null==i?void 0:i.mapping]);(0,o.ge)({isEmpty:m,onLoaded:u});const p=(0,n.useMemo)((()=>y({cube:t,data:s,metaData:c,widgetState:i})),[t,s,c,i]),d=(0,n.useMemo)((()=>(e=>e?(0,b.IM)(o.bR,(0,o.S5)(e.subplots),(0,o.lH)(e.subplots)):{})(c)),[c]);return t&&s&&c&&!m?a().createElement(o.XN,r()({},e,{traces:p,layout:d,cube:t,data:s,metaData:c})):a().createElement(o.MQ,null)}))))}}]);