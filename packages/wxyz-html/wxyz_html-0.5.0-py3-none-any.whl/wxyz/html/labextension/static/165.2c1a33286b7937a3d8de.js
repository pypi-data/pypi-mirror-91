(self.webpackChunk_deathbeds_wxyz_html=self.webpackChunk_deathbeds_wxyz_html||[]).push([[165],{165:(e,t,n)=>{"use strict";n.r(t),n.d(t,{FileBoxModel:()=>y,FileBoxView:()=>b,FileModel:()=>v,FileView:()=>x,FullscreenModel:()=>r,FullscreenView:()=>d,JSONFileModel:()=>w,TextFileModel:()=>f});var i=n(842),s=n.n(i),a=n(608),l=n(983),o=n(139);class r extends l.BoxModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:r.model_name,_model_module:o.A,_model_module_version:o.q,_view_name:r.view_name,_view_module:o.A,_view_module_version:o.q})}}r.model_name="FullscreenModel",r.model_module=o.A,r.model_module_version=o.q,r.view_name="FullscreenView",r.view_module=o.A,r.view_module_version=o.q;class d extends l.BoxView{initialize(e){super.initialize(e),this.pWidget.addClass("jp-WXYZ-Fullscreen")}events(){return{click:e=>{return t=this,n=void 0,l=function*(){const t=e;a.Platform.accelKey(t)&&t.shiftKey&&s()&&s().isEnabled&&(yield s().request(this.el))},new((i=void 0)||(i=Promise))((function(e,s){function a(e){try{r(l.next(e))}catch(e){s(e)}}function o(e){try{r(l.throw(e))}catch(e){s(e)}}function r(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,o)}r((l=l.apply(t,n||[])).next())}));var t,n,i,l}}}}var u=n(850),h=n(601),c=n(81),m=n(797),_=n(753),g=function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function l(e){try{r(i.next(e))}catch(e){a(e)}}function o(e){try{r(i.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,o)}r((i=i.apply(e,t||[])).next())}))};const p="jp-WXYZ-FileBox-dragover";class v extends c.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:v.model_name,_view_name:v.view_name,_model_module:o.A,_model_module_version:o.q,_view_module:o.A,_view_module_version:o.q,name:"Untitled.txt",mime_type:"text/plain",last_modified:+new Date,size:0,value:null})}set file(e){const t=new FileReader;t.onload=()=>{this.set({value:t.result}),this.save_changes()},t.readAsArrayBuffer(e)}}v.model_name="FileModel",v.view_name="FileView",v.model_module=o.A,v.model_module_version=o.A,v.view_module=o.q,v.view_module_version=o.q,v.serializers=Object.assign(Object.assign({},_.WXYZ.serializers),{value:{serialize:e=>new DataView((e||new ArrayBuffer(0)).slice(0))}});class f extends v{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:f.model_name,name:"untitled.txt",mime_type:"text/plain",last_modified:+new Date,size:0,value:""})}initialize(e,t){super.initialize(e,t);const n=new h.dx(this._on_text,1e3),i=new h.dx(this._on_bytes,1e3);this.on("change:text",(()=>n.invoke()),this),this.on("change:value",(()=>i.invoke()),this)}_on_text(){const e=j(this.get("text"));e&&e!==this.get("value")&&setTimeout((()=>{this.set({value:e}),this.save_changes()}),100)}_on_bytes(){let e,t,n=this.get("value");n instanceof ArrayBuffer?t=n:n instanceof DataView?t=n.buffer:e=n,null!=t&&(e=String.fromCharCode.apply(null,new Uint8Array(t)));const i=this.get("text");e&&e!==i&&setTimeout((()=>{this.set({text:e}),this.save_changes()}),100)}}class w extends v{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:w.model_name,name:"Untitled.json",mime_type:"application/json",last_modified:+new Date,size:2,value:"{}"})}initialize(e,t){super.initialize(e,t);const n=new h.dx(this._on_json,1e3),i=new h.dx(this._on_bytes,1e3);this.on("change:json",(()=>n.invoke()),this),this.on("change:value",(()=>i.invoke()),this)}_on_json(){const e=this.get("json"),t=j(JSON.stringify(e,null,2));t&&t!==this.get("value")&&setTimeout((()=>{this.set({value:t}),this.save_changes()}),100)}_on_bytes(){let e,t,n=this.get("value");n instanceof ArrayBuffer?t=n:n instanceof DataView?t=n.buffer:e=n,null!=t&&(e=String.fromCharCode.apply(null,new Uint8Array(t)));const i=JSON.parse(e),s=this.get("json");i&&!m.JSONExt.deepEqual(i,s)&&setTimeout((()=>{this.set({json:i}),this.save_changes()}),100)}}class x extends c.DOMWidgetView{initialize(e){super.initialize(e);const t=this.model;t.on("change:name",this.onNameChange,this),t.on("change:value",this.onValueChange,this)}render(){this.pWidget.addClass("jp-RenderedHTMLCommon"),this.anchor=document.createElement("a"),this.anchor.target="_blank",this.el.appendChild(this.anchor),this.onNameChange(),this.onValueChange()}onNameChange(){const e=this.model.get("name");this.anchor.text=this.anchor.download=e}onValueChange(){this.anchor.href&&URL.revokeObjectURL(this.anchor.href);const e=this.model.get("value");let t="#";if(null!=e){let n=new Blob([e],{type:this.model.get("mime_type")});t=URL.createObjectURL(n)}this.anchor.href=t}}class y extends _.WXYZBox{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:y.model_name,_view_name:y.view_name})}get multiple(){let e=this.get("multiple");return null==e||e}get accept(){let e=this.get("accept");return null==e?"":e.join(",")}}y.model_name="FileBoxModel",y.view_name="FileBoxView";class b extends l.BoxView{events(){return{dragenter:"onDragEnter",dragover:"onDragOver",dragleave:"onDragLeave",dragend:"onDragLeave",dragexit:"onDragLeave",drop:"onDrop"}}initialize(e){super.initialize(e);const t=this._input=this.makeInput(),n=this.makeTarget();this.el.appendChild(t),this.el.appendChild(n),this.model.on("change:multiple change:accept",this.onInputAttributes,this),this.onInputAttributes()}onDragEnter(e){e.stopPropagation(),e.preventDefault()}onDragOver(e){e.stopPropagation(),e.preventDefault(),this.pWidget.addClass(p)}onDragLeave(e){this.pWidget.removeClass(p)}onDrop(e){e.stopPropagation(),e.preventDefault(),this.pWidget.removeClass(p),this._input.files=e.dataTransfer.files,this.onInputChange().catch(console.warn)}makeInput(){const e=document.createElement("input");return e.type="file",e.addEventListener("change",(()=>this.onInputChange())),e}makeTarget(){const e=document.createElement("div");return e.className="jp-WXYZ-FileBox-DragTarget",e}onInputChange(){return g(this,void 0,void 0,(function*(){const e=yield Promise.all((0,u.toArray)(this._input.files).map((e=>g(this,void 0,void 0,(function*(){const{name:t,type:n,size:i,lastModified:s}=e,a=yield(0,_.createModel)(this.model.widget_manager,o.A,v.model_name,v.view_name,{last_modified:s,mime_type:n,name:t,size:i});return a.file=e,a})))));this.model.set({children:e}),this.touch()}))}onInputAttributes(){const e=this._input,t=this.model;e.multiple=t.multiple,e.accept=t.accept}}function j(e){let t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0,i=e.length;t<i;t++)n[t]=e.charCodeAt(t);return t}}}]);